{% extends 'dispositivos/base.html' %}

{% block title %}Portal de Relatórios{% endblock %}

{% block content %}
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2">Relatórios</h1>
        <div>
            <div class="dropdown d-inline-block me-2">
                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-graph-up"></i> Selecionar Categoria
                </button>
                <ul class="dropdown-menu">
                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios' %}"><strong>Visão Geral</strong></a></li>
                    
                    <li><hr class="dropdown-divider"></li>

                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_chamados' %}">Análises de Chamados</a></li>

                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_computadores' %}">Análises de Computadores</a></li>

                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_impressoras' %}">Análises de Impressoras</a></li>

                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_manutencoes' %}">Análises de Manutencoes</a></li>

                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_roteadores' %}">Análises de Roteadores</a></li>
                    
                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_servidores' %}">Análises de Servidores</a></li>
                    
                    <li><a class="dropdown-item" href="{% url 'dispositivos:relatorios_treinamentos' %}">Análises de Treinamentos</a></li>



                </ul>
            </div>
            
            
                <a href="{% url 'dispositivos:exportacao_relatorios' %}" class="btn btn-outline-primary">
                <i class="bi bi-printer-fill"></i> Exportar
            </a>
           
        </div>
    </div>

    <div id="report-container">
        <div class="row">
            <div class="col-lg-6 mb-4">
                <div class="card p-3 h-100">
                    {{ graph_geral_dispositivos|safe }}
                </div>
            </div>
            <div class="col-lg-6 mb-4">
                <div class="card p-3 h-100">
                    {{ graph_geral_chamados|safe }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}


{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const reportContentDiv = document.getElementById('report-content');
    const reportLinks = document.querySelectorAll('.report-link');

    // Função para carregar um relatório específico via API
    async function loadReport(reportName) {
        // Mostra um indicador de carregamento
        reportContentDiv.innerHTML = `
            <div class="d-flex justify-content-center align-items-center" style="height: 400px;">
                <div class="spinner-border" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
            </div>`;
        
        try {
            const url = `{% url 'dispositivos:api_relatorio' %}?name=${reportName}`;
            const response = await fetch(url);
            const data = await response.json();
            
            reportContentDiv.innerHTML = `<div class="card p-4">${data.html}</div>`;
        } catch (error) {
            console.error('Erro ao carregar o relatório:', error);
            reportContentDiv.innerHTML = "<div class='alert alert-danger'>Falha ao carregar o relatório.</div>";
        }
    }

    // Adiciona o evento de clique para cada link no dropdown
    reportLinks.forEach(function(link) {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            const reportName = this.dataset.reportName;
            if (reportName) {
                loadReport(reportName);
            }
        });
    });
});
</script>
{% endblock %}